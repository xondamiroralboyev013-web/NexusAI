name: Verify & Release

on:
  push:
    branches: [ main, master ]
  workflow_dispatch: {}

jobs:
  verify:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Verify app files
        run: |
          echo "‚úÖ Checking app files..."
          [ -f "www/app.html" ] && echo "‚úÖ app.html found" || (echo "‚ùå app.html missing" && exit 1)
          [ -f "www/index.html" ] && echo "‚úÖ index.html found" || (echo "‚ùå index.html missing" && exit 1)
          [ -f "config.xml" ] && echo "‚úÖ config.xml found" || (echo "‚ùå config.xml missing" && exit 1)
          [ -f "package.json" ] && echo "‚úÖ package.json found" || (echo "‚ùå package.json missing" && exit 1)
          [ -f "www/logo.svg" ] && echo "‚úÖ logo.svg found" || (echo "‚ùå logo.svg missing" && exit 1)
          echo "‚úÖ All essential files present!"

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm ci

      - name: Verify Groq API configuration
        run: |
          echo "‚úÖ Checking Groq API configuration..."
          if grep -q "api.groq.com" www/index.html; then
            echo "‚úÖ Groq API endpoint configured"
          else
            echo "‚ùå Groq API endpoint missing"
            exit 1
          fi
          
          if grep -q "mixtral-8x7b-32768" www/index.html; then
            echo "‚úÖ Mixtral model configured"
          else
            echo "‚ö†Ô∏è Model configuration might need update"
          fi

      - name: Create release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            www/app.html
            www/index.html
            www/manifest.json
            www/logo.svg
            APK-BUILD-GUIDE.md
            DEPLOYMENT-READY.md
          tag_name: v${{ github.run_number }}
          draft: false
          prerelease: false
          body: |
            # NexusAI Release v${{ github.run_number }}
            
            ## üöÄ Ready to Use!
            
            ### Web Version (Use Immediately)
            1. Download `app.html` from this release
            2. Open in Chrome/Firefox on any device
            3. Add Groq API key & start chatting
            
            ### Features
            ‚úÖ AI Chat with Groq Mixtral 8x7B
            ‚úÖ Voice Input & Output
            ‚úÖ Web Search Integration
            ‚úÖ Image Generation/Search
            ‚úÖ Dark/Light Mode
            ‚úÖ 100+ Languages
            
            ### Build APK Locally
            See `APK-BUILD-GUIDE.md` for complete instructions:
            ```bash
            npm install
            cordova platform add android
            cordova build android --release
            ```
            
            ### API Configuration
            Get free Groq API key: https://console.groq.com
            
            ### Files Included
            - `app.html` - Web version (no build needed)
            - `APK-BUILD-GUIDE.md` - Complete build instructions
            - `DEPLOYMENT-READY.md` - Deployment guide
            - `www/logo.svg` - NexusAI logo
            ```
            
            APK will be at: `platforms/android/app/build/outputs/apk/debug/app-debug.apk`
            
            **See APK-VERIFICATION.md for complete details!**
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Build status
        run: |
          echo "‚úÖ Release created successfully!"
          echo "üì± App files ready"
          echo "üîó Download from releases tab"
