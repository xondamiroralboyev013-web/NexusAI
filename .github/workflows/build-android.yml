name: Verify & Release

on:
  push:
    branches: [ main, master ]
  workflow_dispatch: {}

jobs:
  verify:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Verify app files
        run: |
          echo "‚úÖ Checking app files..."
          [ -f "www/app.html" ] && echo "‚úÖ app.html found" || echo "‚ùå app.html missing"
          [ -f "www/index.html" ] && echo "‚úÖ index.html found" || echo "‚ùå index.html missing"
          [ -f "config.xml" ] && echo "‚úÖ config.xml found" || echo "‚ùå config.xml missing"
          [ -f "package.json" ] && echo "‚úÖ package.json found" || echo "‚ùå package.json missing"
          echo "‚úÖ All essential files present!"

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm ci

      - name: Verify API token in app
        run: |
          if grep -q "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" www/index.html; then
            echo "‚úÖ OpenRouter API token found in index.html"
          else
            echo "‚ö†Ô∏è API token not found - web version may need manual setup"
          fi
          
          if grep -q "gpt-3.5-turbo" www/index.html; then
            echo "‚úÖ GPT-3.5-Turbo model configured"
          else
            echo "‚ö†Ô∏è Model configuration might need update"
          fi

      - name: Create release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            www/app.html
            www/index.html
            www/manifest.json
            APK-VERIFICATION.md
          tag_name: release-${{ github.run_number }}
          draft: false
          prerelease: false
          body: |
            # NexusAI Release ${{ github.run_number }}
            
            ## üöÄ Ready to Use!
            
            ### Web Version (Use Immediately)
            1. Download `app.html` from this release
            2. Open in Chrome/Firefox on any device
            3. Create account & start chatting
            
            ### Features
            ‚úÖ AI Chat with Groq LLaMA 3.1 8B
            ‚úÖ Voice Input & Output
            ‚úÖ Application Writer
            ‚úÖ OAuth Authentication
            ‚úÖ Dark/Light Mode
            ‚úÖ Pre-configured (no setup needed)
            
            ### Build APK Locally
            ```powershell
            cd c:\Users\PC\OneDrive\Desktop\NexusAI
            npm install
            cordova build android --debug
            ```
            
            APK will be at: `platforms/android/app/build/outputs/apk/debug/app-debug.apk`
            
            **See APK-VERIFICATION.md for complete details!**
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Build status
        run: |
          echo "‚úÖ Release created successfully!"
          echo "üì± App files ready"
          echo "üîó Download from releases tab"
